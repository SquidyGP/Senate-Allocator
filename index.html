<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Senate Seat Allocator</title>
<style>
body { font-family: Arial, sans-serif; margin: 2rem; background: #f0f2f5; }
h1, h2 { color: #333; }
table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
input { width: 100%; padding: 0.4rem; box-sizing: border-box; }
button { padding: 0.5rem 1rem; font-size: 1rem; margin-bottom: 1rem; }
pre { background: #fff; padding: 1rem; border-radius: 5px; overflow-x: auto; }
.add-row { margin-bottom: 1rem; }
</style>
</head>
<body>

<h1>Senate Seat Allocator</h1>

<h2>House Results</h2>
<table id="houseTable">
    <thead>
        <tr><th>Party Name</th><th>Votes</th><th>Action</th></tr>
    </thead>
    <tbody id="houseBody">
        <!-- Pre-populated with Python starting values -->
        <tr><td><input value="Reclaim"></td><td><input type="number" value="6"></td><td><button onclick="deleteRow(this)">Delete</button></td></tr>
        <tr><td><input value="Purple Crown"></td><td><input type="number" value="5"></td><td><button onclick="deleteRow(this)">Delete</button></td></tr>
        <tr><td><input value="Social Democratic"></td><td><input type="number" value="4"></td><td><button onclick="deleteRow(this)">Delete</button></td></tr>
        <tr><td><input value="Solarist"></td><td><input type="number" value="3"></td><td><button onclick="deleteRow(this)">Delete</button></td></tr>
        <tr><td><input value="Progressive"></td><td><input type="number" value="2"></td><td><button onclick="deleteRow(this)">Delete</button></td></tr>
    </tbody>
</table>
<button class="add-row" onclick="addHouseRow()">+ Add Party</button>

<h2>Party Lists (Candidates)</h2>
<table id="partyListTable">
    <thead>
        <tr><th>Party Name</th><th>Candidate Names (comma-separated)</th><th>Action</th></tr>
    </thead>
    <tbody id="partyListBody">
        <!-- Pre-populated with Python starting values -->
        <tr><td><input value="Reclaim"></td><td><input value="Josef, John Louis"></td><td><button onclick="deleteRow(this)">Delete</button></td></tr>
        <tr><td><input value="Purple Crown"></td><td><input value="Cierna"></td><td><button onclick="deleteRow(this)">Delete</button></td></tr>
        <tr><td><input value="Social Democratic"></td><td><input value="Dreamersk"></td><td><button onclick="deleteRow(this)">Delete</button></td></tr>
        <tr><td><input value="Solarist"></td><td><input value="Hiro Solarist"></td><td><button onclick="deleteRow(this)">Delete</button></td></tr>
        <tr><td><input value="Progressive"></td><td><input value="Michael Brain"></td><td><button onclick="deleteRow(this)">Delete</button></td></tr>
    </tbody>
</table>
<button class="add-row" onclick="addPartyListRow()">+ Add Party</button>

<h2>Settings</h2>
<label>Required Vacant Seats:</label>
<input type="number" id="requiredVacant" value="5" min="0">

<br><br>
<button onclick="allocateSeats()">Allocate Seats</button>

<h2>Results</h2>
<pre id="results"></pre>

<script>
function deleteRow(button) {
    button.closest('tr').remove();
}

function addHouseRow() {
    const tbody = document.getElementById("houseBody");
    const row = document.createElement("tr");
    row.innerHTML = `<td><input></td><td><input type="number"></td><td><button onclick="deleteRow(this)">Delete</button></td>`;
    tbody.appendChild(row);
}

function addPartyListRow() {
    const tbody = document.getElementById("partyListBody");
    const row = document.createElement("tr");
    row.innerHTML = `<td><input></td><td><input></td><td><button onclick="deleteRow(this)">Delete</button></td>`;
    tbody.appendChild(row);
}

function allocateSeats() {
    // Read house results in insertion order
    const houseResults = {};
    const partyOrder = []; // preserve order like Python dict
    document.querySelectorAll("#houseTable tbody tr").forEach(row => {
        const [partyCell, votesCell] = row.querySelectorAll("input");
        const party = partyCell.value.trim();
        const votes = parseInt(votesCell.value) || 0;
        if(party) {
            houseResults[party] = votes;
            partyOrder.push(party);
        }
    });

    // Read party lists
    const partyLists = {};
    document.querySelectorAll("#partyListTable tbody tr").forEach(row => {
        const [partyCell, candidatesCell] = row.querySelectorAll("input");
        const party = partyCell.value.trim();
        if(party) {
            partyLists[party] = candidatesCell.value.split(",").map(s => s.trim()).filter(Boolean);
        }
    });

    const requiredVacantSeats = parseInt(document.getElementById("requiredVacant").value);

    let senateSeats = {}, seatAssignments = [], assignedSeats = 0, vacantSeats = 0, occupiedSeats = 0;
    let occupiedByParty = {}, vacantByParty = {};

    for (let party of partyOrder) {
        senateSeats[party] = 0;
        occupiedByParty[party] = 0;
        vacantByParty[party] = 0;
    }

    function getNextCandidate(party) {
        return partyLists[party] && partyLists[party].length ? partyLists[party].shift() : null;
    }

    while(vacantSeats < requiredVacantSeats) {
        // compute quotients
        const quotients = {};
        for(let party of partyOrder) {
            quotients[party] = houseResults[party] / (senateSeats[party]+1);
        }
        const maxQuotient = Math.max(...Object.values(quotients));
        // Tie-breaking: pick first party in partyOrder with max quotient
        const nextParty = partyOrder.find(p => quotients[p] === maxQuotient);

        const candidate = getNextCandidate(nextParty);
        assignedSeats++;
        senateSeats[nextParty]++;

        if(candidate) {
            seatAssignments.push([assignedSeats, nextParty, candidate]);
            occupiedSeats++;
            occupiedByParty[nextParty]++;
        } else {
            seatAssignments.push([assignedSeats, nextParty, "VACANT"]);
            vacantSeats++;
            vacantByParty[nextParty]++;
        }
    }

    // Determine next in line
    const nextQuotients = {};
    for(let party of partyOrder) {
        nextQuotients[party] = houseResults[party] / (senateSeats[party]+1);
    }
    const maxNext = Math.max(...Object.values(nextQuotients));
    const nextInLineParty = partyOrder.find(p => nextQuotients[p] === maxNext);

    // Output results
    let output = "Senate Seat Assignments:\n";
    seatAssignments.forEach(([num, party, member]) => {
        output += `Seat ${num}: ${party} â†’ ${member}\n`;
    });

    output += "\nSeat Totals (including vacant seats):\n";
    for(let party of partyOrder) output += `${party}: ${senateSeats[party]}\n`;

    output += "\nOccupied Seats by Party:\n";
    for(let party of partyOrder) output += `${party}: ${occupiedByParty[party]}\n`;

    output += "\nVacant Seats by Party:\n";
    for(let party of partyOrder) output += `${party}: ${vacantByParty[party]}\n`;

    output += `\nTotal Occupied Seats: ${occupiedSeats}\n`;
    output += `Total Vacant Seats: ${vacantSeats}\n`;
    output += `\nðŸ“Œ Next Party in Line for a Seat: ${nextInLineParty}`;

    document.getElementById("results").textContent = output;
}
</script>

</body>
</html>
